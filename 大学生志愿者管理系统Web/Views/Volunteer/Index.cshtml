@model IEnumerable<DAL.ActivityT>
@{
    ViewBag.Title = "志愿者活动广场";
}

<div class="container">
    <!-- 用户信息部分 -->
    <div class="row">
        <div class="col-md-8">
            <h2>志愿者活动广场</h2>
        </div>
        <div class="col-md-4 text-right">
            @if (Session["Username"] != null)
            {
                <div class="volunteer-info">
                    <p>
                        <span class="label label-success">已登录</span>
                        欢迎, <strong>@Session["Username"]</strong>
                    </p>
                    @if (ViewBag.VolunteerHours != null)
                    {
                        <p>志愿时长: <span class="badge">@ViewBag.VolunteerHours 小时</span></p>
                    }
                </div>
            }
            else
            {
                <p>
                    <a href="@Url.Action("Login", "Account")" class="btn btn-primary">
                        <span class="glyphicon glyphicon-log-in"></span> 登录
                    </a>
                    <a href="@Url.Action("Register", "Account")" class="btn btn-default">
                        <span class="glyphicon glyphicon-user"></span> 注册
                    </a>
                </p>
            }
        </div>
    </div>

    <!-- 搜索和筛选部分 -->
    <div class="row search-panel">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="row">
                        <!-- 按名称搜索 -->
                        <div class="col-md-5">
                            @using (Html.BeginForm("Search", "Volunteer", FormMethod.Get, new { @class = "form-inline" }))
                            {
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" name="keyword" class="form-control" placeholder="活动名称关键词" />
                                        <span class="input-group-btn">
                                            <button type="submit" class="btn btn-primary">
                                                <span class="glyphicon glyphicon-search"></span> 搜索
                                            </button>
                                        </span>
                                    </div>
                                </div>
                            }
                        </div>

                        <!-- 按类型筛选 -->
                        <div class="col-md-5">
                            @using (Html.BeginForm("Filter", "Volunteer", FormMethod.Get, new { @class = "form-inline" }))
                            {
                                <div class="form-group">
                                    <select name="activityType" class="form-control">
                                        <option value="">--选择活动类型--</option>
                                        <option value="教育类">教育类</option>
                                        <option value="社区发展类">社区发展类</option>
                                        <option value="卫生与医疗类">卫生与医疗类</option>
                                        <option value="环境保护类">环境保护类</option>
                                        <option value="动物保护类">动物保护类</option>
                                        <option value="紧急救援类">紧急救援类</option>
                                    </select>
                                    <button type="submit" class="btn btn-info">
                                        <span class="glyphicon glyphicon-filter"></span> 筛选
                                    </button>
                                </div>
                            }
                        </div>

                        <!-- 刷新按钮 -->
                        <div class="col-md-2 text-right">
                            <a href="@Url.Action("Index", "Volunteer")" class="btn btn-default">
                                <span class="glyphicon glyphicon-refresh"></span> 刷新
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 功能按钮区 -->
    <div class="row button-panel">
        <div class="col-md-12">
            <div class="btn-group">
                <a href="@Url.Action("MyApplications", "Volunteer")" class="btn btn-primary">
                    <span class="glyphicon glyphicon-list"></span> 我的申请
                </a>
                <a href="@Url.Action("GetVolunteerHours", "Volunteer")" class="btn btn-success">
                    <span class="glyphicon glyphicon-time"></span> 查看志愿时长
                </a>
                <a href="@Url.Action("SelfCheck", "Volunteer")" class="btn btn-info">
                    <span class="glyphicon glyphicon-user"></span> 个人信息
                </a>
                <a href="@Url.Action("ApplyIdentify", "Volunteer")" class="btn btn-warning">
                    <span class="glyphicon glyphicon-certificate"></span> 申请志愿者证
                </a>
            </div>
        </div>
    </div>

    <!-- 活动列表 -->
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">志愿活动列表</h3>
                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>活动编号</th>
                                    <th>活动名称</th>
                                    <th>活动类型</th>
                                    <th>开始时间</th>
                                    <th>结束时间</th>
                                    <th>地点</th>
                                    <th>需要人数</th>
                                    <th>发起人</th>
                                    <th>活动图片</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model != null && Model.Any())
                                {
                                    foreach (var activity in Model)
                                    {
                                        <tr>
                                            <td>@activity.activity_ID</td>
                                            <td>@activity.activity_Name</td>
                                            <td>@activity.activity_type</td>
                                            <td>@activity.addtime</td>
                                            <td>@activity.stoptime</td>
                                            <td>@activity.place</td>
                                            <td>@activity.renshu</td>
                                            <td>@activity.Holder</td>
                                            <td>
                                                @if (!string.IsNullOrEmpty(activity.Image))
                                                {
                                                    <!-- 将反斜杠转为正斜杠，并确保路径格式正确 -->
                                                    <img src="@Url.Content("~/" + activity.Image.TrimStart('\\').Replace('\\', '/'))" alt="活动图片" class="img-thumbnail activity-thumbnail" />
                                                }
                                                else
                                                {
                                                    <img src="@Url.Content("~/Content/Images/暂无图片.gif")" alt="暂无图片" class="img-thumbnail activity-thumbnail" />
                                                }
                                            </td>
                                            <td>
                                                @if (activity.status == "已结束")
                                                {
                                                    <span class="label label-danger">已结束</span>
                                                }
                                                else
                                                {
                                                    <span class="label label-success">进行中</span>
                                                }
                                            </td>
                                            <td>
                                                <a href="@Url.Action("ActivityDetails", "Volunteer", new { id = activity.activity_ID })" class="btn btn-info btn-sm">
                                                    <span class="glyphicon glyphicon-info-sign"></span> 详情
                                                </a>
                                                <a href="@Url.Action("ApplyActivity", "Volunteer", new { id = activity.activity_ID })" class="btn btn-primary btn-sm">
                                                    <span class="glyphicon glyphicon-ok"></span> 申请
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="11" class="text-center">暂无活动数据</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .search-panel {
        margin-bottom: 15px;
    }

    .button-panel {
        margin-bottom: 20px;
    }

    .volunteer-info {
        background-color: #f9f9f9;
        padding: 10px;
        border-radius: 4px;
        border: 1px solid #eee;
    }

    .activity-thumbnail {
        max-width: 100px;
        max-height: 60px;
    }

    .table > tbody > tr {
        vertical-align: middle;
    }

    .btn-group {
        margin-bottom: 15px;
    }
</style>

@section scripts {
    <script>
        $(document).ready(function () {
            // 点击行跳转到详情页
            $('table tbody tr').click(function () {
                var activityId = $(this).find('td:first').text();
                window.location.href = '@Url.Action("ActivityDetails", "Volunteer")/' + activityId;
            });

            // 阻止操作按钮点击事件冒泡到行
            $('table tbody tr a').click(function (e) {
                e.stopPropagation();
            });
        });
    </script>
}